/**
  * CalEnder: A Datepicker for Ender
  * copyright Dustin Diaz @ded 2011 | License MIT
  * https://github.com/ded/calEnder
  */
!function(a){function d(a){return a%4===0&&a%100!==0||a%400===0}function e(a,b){return[31,d(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]}function f(a){return c.indexOf(a)+1}function g(d,e){var g=this;this.options=e||{},this.$input=a(d).first(),this.$calendar=a(b).appendTo("body"),this.$calendar.delegate("tbody td","mouseover",function(){a(this).closest("tbody").find("td:nth-child("+(this.cellIndex+1)+")").addClass("hover")}),a(document).bind("click",function(a){g.$calendar.removeClass("active")}),this.$calendar.bind("mousedown click",function(a){a.stopPropagation(),a.preventDefault()}),this.$calendar.delegate("tbody td","mouseout",function(){a(this).closest("tbody").find("td:nth-child("+(this.cellIndex+1)+")").removeClass("hover")}),this.$calendar.delegate("tbody td:not(.inactive)","click.day",function(b){var c=a(this).html();g.$input.val([f(g.$calendar.find(".date-current-month").html()),c,g.$calendar.find(".date-current-year").html()].join("-")),g.$calendar.removeClass("active")}),this.$calendar.delegate(".date-month-previous","click",function(a){var b=parseFloat(g.$calendar.find(".date-current-year").html()),d=f(g.$calendar.find(".date-current-month").html())-1;--d==-1&&--b&&(d=11),g.setDate(c[d]+" 1,"+b)}),this.$calendar.delegate(".date-month-next","click",function(b){var d=parseFloat(g.$calendar.find(".date-current-year").html()),e=f(a(".date-current-month").html());e==12&&++d&&(e=0),g.setDate(c[e]+" 1,"+d)}),this.setDate((this.options.date||new Date).toDateString())}var b="<div class='date'>  <table>    <thead>      <tr class='date-header'>        <th class='date-nav date-month-previous'>&#8227;</th>        <th colspan='5' class='date-month-year'>          <span class='date-current-month'></span>          <span class='date-current-year'></span></th>        <th class='date-nav date-month-next'>&#8227;</th>      </tr>      <tr class='date-daysofweek'>        <th>S</th>        <th>M</th>        <th>T</th>        <th>W</th>        <th>R</th>        <th>F</th>        <th>S</th>      </tr>    </thead>    <tbody class='date-days'></tbody>  </table></div>",c=["January","February","March","April","May","June","July","August","September","October","November","December"];g.prototype.setDate=function(b){var d=new Date(b),f=(new Date(d.getFullYear(),d.getMonth(),1)).getDay(),g=e(d.getMonth()?d.getFullYear():d.getFullYear()-1,d.getMonth()?d.getMonth()-1:d.getMonth()),h=[],i=1,j=0,k=g-f,l=e(d.getYear(),d.getMonth()),m=Math.floor((l+f-7)/7),n=0;this.$calendar.find(".date-current-year,.date-current-month,tbody.date-days").empty(),this.$calendar.find(".date-current-year").html(d.getFullYear()),this.$calendar.find(".date-current-month").html(c[d.getMonth()]),h.push("<tr>");while(k<g)h.push('<td class="inactive">'+ ++k+"</td>");while(f<7)h.push("<td>"+ ++j+"</td>"),f++;h.push("</tr>");for(;n<m;n++){h.push("<tr>");var o=0;while(o<7)h.push("<td>"+ ++j+"</td>"),o++;h.push("</tr>")}if(j<l){h.push("<tr>"),n=0;var p=j+7,q=0;while(n<7)j<l?h.push("<td>"+ ++j+"</td>"):h.push('<td class="inactive">'+ ++q+"</td>"),n++;h.push("</tr>")}this.$calendar.find("tbody.date-days").append(h.join(""));var r=new Date;d.getMonth()==r.getMonth()&&d.getFullYear()==r.getFullYear()&&this.$calendar.find(".date tbody.date-days td").each(function(b){b.innerHTML==r.getDate()&&!a(b).hasClass("inactive")&&a(b).addClass("today")})},a.ender({calender:function(b){a(this).forEach(function(c){var d=a(c),e=d.offset(),f=new g(c,b);d.bind("focus click",function(a){a.stopPropagation(),f.$calendar.css({left:e.left,top:e.top+e.height}).addClass("active")}).bind("keydown",function(a){a.keyCode==9&&f.$calendar.removeClass("active")})})}},!0)}(ender)